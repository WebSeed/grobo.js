define("grobo/lib",[],function(){function e(e){if(!e)throw"Input array null or undefined"}var t={each:function(t,n){e(t);var r=0,i=t.length;while(r<i){if(n(t[r],r))break;r++}},reverseEach:function(t,n){e(t);var r=t.length;while(--r>=0)n(t[r],r)},contains:function(t,n){e(t);var r=0,i=t.length;while(r<i){if(t[r]===n)return!0;r++}return!1},last:function(t){return e(t),t[t.length-1]},until:function(t,n){e(t);var r=0,i=t.length;while(r<i){if(n(t[r]))break;r++}},reverseUntil:function(t,n){e(t);var r=t.length;while(--r>=0)if(n(t[r]))break},create:function(e,t){function n(){}n.prototype=e;var r=new n,i,s,o,u;if(t){o=Object.keys(t),s=o.length;for(i=0;i<s;i++)u=o[i],r[u]=t[u]}return r}};return t}),define("grobo/logger",[],function(){var e=document.getElementById("logger");return{log:function(t){console.log(t);if(e){var n=document.createElement("li");n.appendChild(document.createTextNode(t)),e.appendChild(n)}},info:function(e){this.log("Info: "+e)},err:function(e){this.log("Error: "+e)}}}),define("grobo/states/state",["grobo/logger"],function(e){var t={POPUP:0,EXCLUSIVE:1,name:"Base",modality:null,canvas:null,stateFactory:null,stateManager:null,view:null,_initState:function(e){this.canvas=e.canvas||null,this.stateFactory=e.stateFactory||null,this.stateManager=e.stateManager||null},init:function(e){return this._initState(e),this},entered:function(){},exiting:function(){},obscured:function(){},revealed:function(){},update:function(e){},draw:function(){},handleInput:function(e){},getName:function(){return this.name||"unknown"}};return t}),define("grobo/states/game",["grobo/lib","grobo/states/state","grobo/logger"],function(e,t,n){var r=e.create(t,{name:"Game",isAnimating:!1,init:function(e){return this.modality=this.EXCLUSIVE,this._initState(e),this},update:function(e){},draw:function(){this.canvas.fill("yellow")},handleInput:function(e){e.name==="click"&&(e.consume(),this.stateManager.push(this.stateFactory.getMenu()))}});return r}),define("grobo/geom",[],function(){var e={isPointInsideRect:function(e,t,n,r,i,s){return e>=n&&e<=n+i&&t>=r&&t<=r+s}};return e}),define("grobo/ui/view",["grobo/lib","grobo/geom"],function(e,t){var n={canvas:null,parent:null,children:null,width:0,height:0,x:0,y:0,listeners:null,wasLastEventInside:!1,_initView:function(e){this.canvas=e.canvas||null,this.parent=e.parent||null,this.width=e.width||0,this.height=e.height||0,this.x=e.x||0,this.y=e.y||0,this.children=[],this.listeners={click:[],press:[],release:[],move:[],over:[],out:[]},this.wasLastEventInside=!1},init:function(e){return this._initView(e),this},addChild:function(e){return e.parent=this,this.children.push(e),this},removeChild:function(e){var t=this.children.indexOf(e);t!==-1&&(this.children.splice(t,1),e.parent=null)},getWorldX:function(){return this.parent?this.parent.getWorldX()+this.x:this.x},getWorldY:function(){return this.parent?this.parent.getWorldY()+this.y:this.y},draw:function(){this.drawChildren()},drawChildren:function(){e.each(this.children,function(e){e.draw()})},on:function(e,t){var n=this.listeners[e],r=n.indexOf(t);r===-1&&n.push(t)},off:function(e,t){var n=this.listeners[e],r=n.indexOf(t);r!==-1&&n.splice(r,1)},handleInput:function(e){switch(e.name){case"click":this.handleClick(e);break;case"press":this.handlePress(e);break;case"release":this.handleRelease(e);break;case"move":this.handleMove(e)}},handleInputChildren:function(t){return e.reverseUntil(this.children,function(e){return e.handleInput(t),t.isConsumed}),t.isConsumed},isEventInside:function(e){return t.isPointInsideRect(e.x,e.y,this.getWorldX(),this.getWorldY(),this.width,this.height)},handleClick:function(e){this.handleInputChildren(e)||this.triggerIfInside(e)},handlePress:function(e){this.handleInputChildren(e)||this.triggerIfInside(e)},handleRelease:function(e){this.handleInputChildren(e)||this.triggerIfInside(e)},handleMove:function(e){var t=this.isEventInside(e);this.handleInputChildren(e)||t&&this.trigger(e),!this.wasLastEventInside&&t?this.handleOver(e):this.wasLastEventInside&&!t&&this.handleOut(e),this.wasLastEventInside=t},handleOver:function(e){this.trigger({name:"over",source:e})},handleOut:function(e){this.trigger({name:"out",source:e})},trigger:function(t){var n=this.listeners[t.name];n&&n.length>0&&e.each(n,function(e){e(t)})},triggerIfInside:function(e){this.isEventInside(e)&&this.trigger(e)}};return n}),define("grobo/ui/button",["grobo/lib","grobo/ui/view","grobo/geom"],function(e,t,n){var r=e.create(t,{NORMAL_BACKGROUND_STYLE:"white",ACTIVE_BACKGROUND_STYLE:"purple",HOVER_BACKGROUND_STYLE:"green",init:function(e){var t=this;return this._initView(e),this.label=e.label,this.backgroundStyle=this.NORMAL_BACKGROUND_STYLE,this.on("click",function(e){alert("Click!"),e.consume()}),this.on("press",function(e){t.backgroundStyle=t.ACTIVE_BACKGROUND_STYLE,e.consume()}),this.on("release",function(e){t.backgroundStyle=t.NORMAL_BACKGROUND_STYLE,e.consume()}),this.on("over",function(e){t.backgroundStyle=t.HOVER_BACKGROUND_STYLE}),this.on("out",function(e){t.backgroundStyle=t.NORMAL_BACKGROUND_STYLE}),this},update:function(e){},draw:function(){var e=this.getWorldX(),t=this.getWorldY(),n=this.canvas,r=n.getContext();n.fillRect(this.backgroundStyle,e,t,this.width,this.height),r.font="bold 16px sans-serif",r.textAlign="center",r.textBaseline="middle",n.fillText("black",this.label,e+this.width/2,t+this.height/2)}});return r}),define("grobo/ui/panel",["grobo/lib","grobo/ui/view"],function(e,t){var n=e.create(t,{init:function(e){return this._initView(e),this.style=e.style,this},draw:function(){var e=this.getWorldX(),t=this.getWorldY();this.canvas.fillRect(this.style,e,t,this.width,this.height),this.drawChildren()}});return n}),define("grobo/states/menu",["grobo/lib","grobo/states/state","grobo/ui/button","grobo/ui/panel","grobo/logger"],function(e,t,n,r,i){var s=e.create(t,{name:"Menu",isAnimating:!1,init:function(t){this.modality=this.EXCLUSIVE,this._initState(t);var i=e.create(r).init({canvas:this.canvas,width:this.canvas.width,height:this.canvas.height,x:0,y:0,style:"green"}),s=e.create(r).init({canvas:this.canvas,width:this.canvas.width-20,height:this.canvas.height-20,x:10,y:10,style:"red"}),o=e.create(n).init({canvas:this.canvas,width:100,height:80,x:20,y:20,label:"Button 1"}),u=e.create(n).init({canvas:this.canvas,width:100,height:80,x:20,y:200,label:"Button 2"}),a=e.create(n).init({canvas:this.canvas,width:100,height:80,x:120,y:110,label:"Button 3"});return i.addChild(s),s.addChild(o).addChild(u).addChild(a),this.view=i,this},entered:function(){this.isAnimating=!0,this.view.x=this.canvas.width},update:function(e){this.isAnimating&&this.view.x>0&&(this.view.x-=e,this.view.x<=0&&(this.view.x=0,this.isAnimating=!1))},draw:function(){this.view.draw()},handleInput:function(e){console.log(e.x+", "+e.y),this.view.handleInput(e),e.name==="click"&&!e.isConsumed&&(e.consume(),this.stateManager.push(this.stateFactory.getHelp()))}});return s}),define("grobo/states/help",["grobo/lib","grobo/states/state","grobo/logger"],function(e,t,n){var r=e.create(t,{name:"Help",modality:t.POPUP,init:function(e){return this.modality=this.POPUP,this._initState(e),this},update:function(e){},draw:function(e){this.canvas.fill("rgba(0, 0, 0, 0.5)")},handleInput:function(e){e.name==="click"&&this.stateManager.pop(),e.consume()}});return r}),define("grobo/state-factory",["grobo/lib","grobo/states/game","grobo/states/menu","grobo/states/help"],function(e,t,n,r){var i={init:function(e){return e.stateFactory=this,this.config=e,this.states={},this},getGame:function(){return this.states.game||(this.states.game=e.create(t).init(this.config)),this.states.game},getMenu:function(){return this.states.menu||(this.states.menu=e.create(n).init(this.config)),this.states.menu},getHelp:function(){return this.states.help||(this.states.help=e.create(r).init(this.config)),this.states.help}};return i}),define("grobo/polyfills/function-bind",[],function(){if(!Function.prototype.bind){var e=this,t=[].slice,n=function(n){var r=t.call(arguments,1),i=this,s=function(){},o=function(){return i.apply(this instanceof s?this:n||{},r.concat(t.call(arguments)))};return s.prototype=this.prototype||{},o.prototype=new s,o};Function.prototype.bind=n}}),define("grobo/state-manager",["grobo/lib","grobo/states/state","grobo/logger","grobo/polyfills/function-bind"],function(e,t,n){var r={init:function(e){return e.onEvent(this.handleInput.bind(this)),this.stack=[],this},getActiveStates:function(){var n=[];return e.reverseUntil(this.stack,function(e){return n.push(e),e.modality===t.EXCLUSIVE}),n.reverse()},tick:function(e){var t=this.getActiveStates();this.update(t,e),this.draw(t)},update:function(t,n){e.each(t,function(e){e.update(n)})},draw:function(t){e.each(t,function(e){e.draw()})},change:function(e){var t;e&&!this.contains(e)&&(t=this.pop(),this.push(e))},peek:function(){return this.isEmpty()?null:e.last(this.stack)},push:function(n){return this.contains(n)||(e.reverseUntil(this.stack,function(e){return e.obscured(),e.modality===t.EXCLUSIVE}),this.stack.push(n),n.entered()),this},pop:function(){var n=null;return this.isEmpty()?null:(n=this.stack.pop(),n.exiting(),e.reverseUntil(this.stack,function(e){return e.revealed(),e.modality===t.EXCLUSIVE}),n)},contains:function(t){return e.contains(this.stack,t)},size:function(){return this.stack.length},isEmpty:function(){return this.size()===0},handleInput:function(n){e.reverseUntil(this.stack,function(e){return e.handleInput(n),e.modality===t.EXCLUSIVE||n.isConsumed})},toString:function(){e.each(this.stack,function(e,t){console.log(t+" state: "+e.modality)})}};return r}),define("grobo/fps",[],function(){var e={init:function(e,t){this.time=0,this.frame=0,this.sampleSize=e||100,this.framesPerSecond=0,this.callback=t},tick:function(e){this.frame++,this.time+=e,this.frame===this.sampleSize&&(this.framesPerSecond=(this.frame/this.time*1e3).toFixed(2),this.callback&&this.callback(this.framesPerSecond),this.time=0,this.frame=0)}};return e}),define("grobo/polyfills/animation-frame",[],function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}),define("grobo/engine",["grobo/fps","grobo/logger","grobo/polyfills/function-bind","grobo/polyfills/animation-frame"],function(e,t){var n={init:function(n){var r=this;return this.stateManager=n,this.tickCount=0,this.requestId=null,this.isRunning=!1,this.lastTime=null,e.init(120,function(e){t.info(e)}),this},start:function(){this.isRunning||(this.requestId=window.requestAnimationFrame(this.tick.bind(this)),this.isRunning=!0)},stop:function(){this.isRunning&&(window.cancelAnimationFrame(this.requestId),this.isRunning=!1)},tick:function(){var t=new Date,n=0;this.tickCount+=1,this.lastTime&&(n=t-this.lastTime),this.stateManager.tick(n),this.lastTime=t,this.requestId=window.requestAnimationFrame(this.tick.bind(this)),e.tick(n)}};return n}),define("grobo/canvas",[],function(){var e={width:0,height:0,init:function(e){return this.element=document.getElementById(e),this.context2d=this.element.getContext("2d"),this.width=this.element.width,this.height=this.element.height,this},clear:function(){this.context2d.clearRect(0,0,this.width,this.height)},fill:function(e){this.fillRect(e,0,0,this.width,this.height)},fillRect:function(e,t,n,r,i){this.context2d.fillStyle=e,this.context2d.fillRect(t,n,r,i)},fillText:function(e,t,n,r){this.context2d.fillStyle=e,this.context2d.fillText(t,n,r)},getElement:function(){return this.element},getContext:function(){return this.context2d},getCoords:function(e){var t=this.element.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}};return e}),define("grobo/input",[],function(){function t(e,t,n){var r=e.getCoords(t);return{name:n,x:r.x,y:r.y,isConsumed:!1,consume:function(){this.isConsumed=!0}}}var e={eventMap:{click:"click",press:"mousedown",release:"mouseup",move:"mousemove"},init:function(e){return this.canvas=e,this},on:function(e,n){var r=this,i=this.eventMap[e];this.canvas.getElement().addEventListener(i,function(i){n(t(r.canvas,i,e)),i.preventDefault()})},off:function(e,t){this.canvas.getElement().removeEventListener(this.eventMap[e],t,!1)},onEvent:function(e){this.on("click",e),this.on("press",e),this.on("release",e),this.on("move",e)},offEvent:function(e){this.off("click",e),this.off("press",e),this.off("release",e),this.off("move",e)}};return e}),require(["grobo/lib","grobo/state-factory","grobo/state-manager","grobo/engine","grobo/canvas","grobo/input"],function(e,t,n,r,i,s){var o=e.create(i).init("canvas"),u=e.create(s).init(o),a=e.create(n).init(u),f={stateManager:a,canvas:o},l=e.create(t).init(f),c=e.create(r).init(a);a.change(l.getGame()),c.start()}),define("main",function(){});